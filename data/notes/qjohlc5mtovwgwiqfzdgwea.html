<h1 id="dell-server-fan-tamer">Dell Server Fan Tamer<a aria-hidden="true" class="anchor-heading icon-link" href="#dell-server-fan-tamer"></a></h1>
<h2 id="dell-server-fan-tamer-1">Dell Server Fan Tamer<a aria-hidden="true" class="anchor-heading icon-link" href="#dell-server-fan-tamer-1"></a></h2>
<p>Copy the code below and modify to your content. Comments inside the script explain how to use this script and what tools are required.
I have used this script on <strong>Dell R710</strong> (an oldie I know) with a great success.
With some tweaking it will work with other models too.
I have adapted it to <strong>Dell R210</strong> also but those servers have minimum fan speed around 5250 RPM which is still audible. Below that speed, fans just stop which is not really desirable ;) </p>
<pre class="language-sh"><code class="language-sh">#!/bin/bash

#This script makes Dell servers like R710 and other super quiet for home lab use.  
#I have chosen readings from hottest cores on each cpu in order to regulate the fan speed.  
#To control fan speed we need ipmitool.  
#Install with: &#x3C;sudo apt install ipmitool>  
#To identify hot cores or to check cpu temperatures in general, use sensors.  
#To install: &#x3C;sudo apt install lm-sensors>  
#I running it as a cron job every 1 minute.  
#Server on every reboot/power loss will revert to default fan speed control.  

hotcorecpu1=$(sensors coretemp-isa-0000 | grep "Core 9:" | awk -F '[+.0]' {'print $2'})  
hotcorecpu2=$(sensors coretemp-isa-0001 | grep "Core 0:" | awk -F '[+.0]' {'print $2'})  
	
#Switch off automatic fan speed control
#You can leave this command here or add it as a cron job on each reboot and then comment it out here. 
#Without it automatic fan control will be restored within few seconds.
	
	ipmitool -U root -P calvin raw 0x30 0x30 0x01 0x00

#HOW I RUN IT:
#Add this record to your crontab -e (root cronjobs):
#	*/1 * * * *     /bin/fancontrol.sh #to run script every 1 minute in root cronjobs

#Testing readings:
#echo $hotcorecpu1
#echo $hotcorecpu2


	if [[($hotcorecpu1 -ge 1) || ($hotcorecpu2 -ge 1)]] &#x26;&#x26; [[($hotcorecpu1 -lt 41) || ($hotcorecpu2 -lt 41)]]
		then
		ipmitool -U root -P calvin raw 0x30 0x30 0x02 0xff 0x04 #4% of fan speed
	elif [[($hotcorecpu1 -ge 41) || ($hotcorecpu2 -ge 41)]] &#x26;&#x26; [[($hotcorecpu1 -lt 45) || ($hotcorecpu2 -lt 45)]]
		then
		ipmitool -U root -P calvin raw 0x30 0x30 0x02 0xff 0x0a #10% of fan speed
	elif [[($hotcorecpu1 -ge 45) || ($hotcorecpu2 -ge 45)]] &#x26;&#x26; [[($hotcorecpu1 -lt 51) || ($hotcorecpu2 -lt 51)]]
		then
		ipmitool -U root -P calvin raw 0x30 0x30 0x02 0xff 0x14 #20% of fan speed
	elif [[($hotcorecpu1 -ge 51) || ($hotcorecpu2 -ge 51)]] &#x26;&#x26; [[($hotcorecpu1 -lt 55) || ($hotcorecpu2 -lt 55)]]
		then
		ipmitool -U root -P calvin raw 0x30 0x30 0x02 0x23 0x1e #35% of fan speed
	elif [[($hotcorecpu1 -ge 55) || ($hotcorecpu2 -ge 55)]] &#x26;&#x26; [[($hotcorecpu1 -lt 64) || ($hotcorecpu2 -lt 64)]]
		then
        ipmitool -U root -P calvin raw 0x30 0x30 0x02 0xff 0x32 #50% of fan speed
	else #panic mode
		ipmitool -U root -P calvin raw 0x30 0x30 0x02 0xff 0x50 #80% of fan speed
	fi

#To check fans speed at any time run (this command should work remotely also as it is connects to your iDrac):
# ipmitool -I lanplus -H &#x3C;YOUR IP> -U root -P calvin sdr elist all | grep -i fan
	
#Enjoy silent server!
</code></pre>
<h2 id="download">Download:<a aria-hidden="true" class="anchor-heading icon-link" href="#download"></a></h2>
<p><a href="https://github.com/Greguus/Notes/blob/main/fancontrol.sh">fancontrol.sh</a></p>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/Notes/notes/kh3qu6gbkqp3jojuo9qgkzl">SCRIPTS:</a></li>
</ul>